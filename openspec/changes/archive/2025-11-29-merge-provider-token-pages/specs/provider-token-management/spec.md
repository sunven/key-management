# 统一的提供商-令牌管理

## ADDED Requirements

### Requirement: 统一的提供商列表与令牌展示

系统 SHALL 在单个统一界面中显示提供商及其关联的令牌，允许用户在不需要在不同页面之间导航的情况下管理这两种实体。

#### Scenario: 显示提供商列表及令牌数量

- **WHEN** 用户导航到 `/providers` 页面
- **THEN** 显示一个提供商表格，包含名称、基础URL、描述、状态、令牌数量和操作列
- **AND** 每个提供商行显示其关联令牌的总数

#### Scenario: 展开提供商以显示令牌

- **WHEN** 用户点击提供商行上的展开图标
- **THEN** 提供商行展开，显示该提供商关联的所有令牌的嵌套列表或表格
- **AND** 每个令牌显示其遮罩后的值、状态、创建日期和操作按钮（编辑、删除）

#### Scenario: 折叠已展开的提供商

- **WHEN** 用户点击已展开提供商行上的折叠图标
- **THEN** 嵌套的令牌列表被隐藏
- **AND** 提供商行恢复为紧凑状态

#### Scenario: 同时展开多个提供商

- **WHEN** 用户展开多个提供商行
- **THEN** 所有已展开的提供商及其令牌列表保持可见
- **AND** 每个提供商的展开状态是独立的

### Requirement: 在提供商上下文中管理令牌

系统 SHALL 允许用户在统一的提供商-令牌界面内执行所有令牌的增删改查操作，无需导航到单独的令牌页面。

#### Scenario: 从展开视图向提供商添加令牌

- **WHEN** 用户展开一个提供商并点击该提供商区域内的"添加令牌"按钮
- **THEN** 令牌对话框打开，提供商已预选
- **AND** 用户只能向当前展开的提供商添加令牌（在此上下文中不需要提供商选择下拉框）
- **AND** 令牌创建成功后，提供商的令牌列表刷新以显示新令牌

#### Scenario: 从提供商视图编辑令牌

- **WHEN** 用户在展开的提供商区域内点击令牌的"编辑"按钮
- **THEN** 令牌对话框打开，预填充该令牌的当前值
- **AND** 用户可以修改令牌值
- **AND** 更新成功后，令牌列表刷新以显示更新后的值

#### Scenario: 从提供商视图删除令牌

- **WHEN** 用户在展开的提供商区域内点击令牌的"删除"按钮
- **THEN** 显示确认对话框
- **AND** 确认后，令牌被删除
- **AND** 提供商的令牌列表刷新以反映删除操作

#### Scenario: 令牌遮罩和可见性切换

- **WHEN** 令牌在展开的提供商区域内显示
- **THEN** 令牌值默认被遮罩（显示 `***...last4`）
- **AND** 用户可以点击眼睛图标来显示完整的令牌值
- **AND** 点击闭眼图标再次遮罩令牌
- **AND** 每个令牌的可见性状态独立跟踪

### Requirement: 令牌路由弃用

系统 SHALL 通过将用户重定向到统一的 `/providers` 页面来优雅地处理现有的 `/tokens` 路由书签。

#### Scenario: 用户导航到已弃用的令牌路由

- **WHEN** 用户导航到 `/tokens` URL
- **THEN** 系统自动重定向到 `/providers`
- **AND** 不显示错误或404页面

#### Scenario: 直接访问令牌页面

- **WHEN** 用户尝试通过书签或外部链接访问 `/tokens`
- **THEN** 重定向无缝发生，无需用户交互

### Requirement: 导航更新

系统 SHALL 更新导航链接以反映统一的提供商-令牌管理界面。

#### Scenario: 移除导航栏令牌链接

- **WHEN** 用户查看应用导航栏
- **THEN** 仅显示"Dashboard"和"Providers"链接
- **AND** 不存在"Tokens"链接

#### Scenario: 更新仪表板快速操作

- **WHEN** 用户查看仪表板页面
- **THEN** "快速操作"卡片显示单个"管理提供商与令牌"按钮（或"管理提供商"）
- **AND** 点击该按钮导航到 `/providers`

### Requirement: 提供商-令牌数据完整性

系统 SHALL 在统一界面中显示提供商和令牌时，维护所有现有的安全控制、用户隔离和数据关系。

#### Scenario: 统一视图中的用户隔离

- **WHEN** 用户访问统一的提供商-令牌页面
- **THEN** 仅显示已认证用户拥有的提供商
- **AND** 仅显示属于用户提供商的令牌
- **AND** 其他用户的数据不可访问

#### Scenario: 级联删除感知

- **WHEN** 用户删除具有关联令牌的提供商
- **THEN** 警告消息指示所有关联的令牌将被删除
- **AND** 确认后，提供商及其令牌都被移除
- **AND** 此行为与先前的实现保持不变

#### Scenario: 无提供商选择的令牌创建

- **WHEN** 用户尝试从统一视图添加令牌
- **THEN** 如果从顶层"添加令牌"按钮访问，令牌对话框可能仍需要提供商选择
- **OR** 如果从展开的提供商区域内访问，提供商已预选
- **AND** 用户不能为他们不拥有的提供商创建令牌
